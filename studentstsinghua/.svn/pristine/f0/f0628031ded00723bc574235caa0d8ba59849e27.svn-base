package com.qq.weixin.sdk.messageHadler;

import java.util.Date;

import org.w3c.dom.Element;

import com.qq.weixin.sdk.message.IMessage;
import com.qq.weixin.sdk.message.Message;

public abstract class AbstractMessageHandler implements IMessageHadler, IMessage {

	// subclass implements it
	protected abstract void parseSpecialMessage(Message message, Element root);

	// put common parse part here!
	@Override
	public void parseMessage(Message message, Element root) {
		message.setMsgType(root.getElementsByTagName(TAG_MSGTYPE).item(0).getTextContent());
		message.setMsgId(Long.parseLong((root.getElementsByTagName(TAG_MSGID)).item(0).getTextContent()));
		message.setCreateTime(Integer.parseInt((root.getElementsByTagName(TAG_CREATETIME)).item(0).getTextContent()));
		message.setFromUserName((root.getElementsByTagName(TAG_FROMUSERNAME)).item(0).getTextContent());
		message.setToUserName((root.getElementsByTagName(TAG_TOUSERNAME)).item(0).getTextContent());
		parseSpecialMessage(message, root);
	}

	// do nothing here!
	@Override
	public Message handleMessage(Message message) {
		return null;
	}

	// get current Unix time
	public int getCurrentUnixTimestamp() {
		Date date = new Date();
		return (int) (date.getTime() / 1000);
	}

}
